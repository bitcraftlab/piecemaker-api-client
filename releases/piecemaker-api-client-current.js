/**
 *	Piecemaker 2 API client (JavaScript version) for Motion Bank.
 *
 *	See: 
 *	  https://github.com/motionbank/piecemaker2-api
 *	  https://github.com/motionbank/piecemaker-api-client
 *
 *	Project:
 *	  http://piecemaker.org
 *	  http://motionbank.org
 *
 *	Version: 0.0.11, build: 760
 */
 (function(){var s=function(j){var f=function(){},k=function(a){if(!a||"object"!==typeof a)return a;if("entrySet"in a&&"function"===typeof a.entrySet){var b=a.entrySet();if(!b)return a;a={};for(b=b.iterator();b.hasNext();){var c=b.next(),e=c.getValue();e&&("object"===typeof e&&"entrySet"in e&&"function"===typeof e.entrySet)&&(e=k(e));var d=c.getKey();if(!d)throw"Field key is not valid: "+d;a[c.getKey()]=e}return a}"utc_timestamp"in a&&(a.utc_timestamp=o(a.utc_timestamp));"created_at"in a&&(a.created_at=
o(a.created_at));return a},i=function(a){if(a instanceof Array){for(var b=[],c=0;c<a.length;c++)b.push(m(l(a[c])));return b}return a},l=function(a){var b=a.event;b.fields={};for(var c=0,a=a.fields;c<a.length;c++)b.fields[a[c].id]=a[c].value;return b},m=function(a){a.fields.get=function(b){return a.fields[b]};a.utc_timestamp=new Date(1E3*a.utc_timestamp);return a},o=function(a){return a instanceof Date?a.getTime()/1E3:9999999999<a?a/1E3:a},p=function(a,b,c,e,u){if(!d.api_key&&!b.match(/\/user\/login$/))throw"PieceMakerApi: need an API_KEY, please login first to obtain one";
var f=(new Date).getTime(),g=b+".json";j({url:g,type:c,dataType:"json",data:e||{},context:a,success:function(){arguments&&(arguments[0]&&"object"===typeof arguments[0]&&!(arguments[0]instanceof Array)&&!("queryTime"in arguments[0]))&&(arguments[0].queryTime=(new Date).getTime()-f);u.apply(a,arguments)},error:function(a){var b=-1,e="";a&&(b=a.status||a.statusCode,e=a.statusText||a.message||"No error message",a.responseText&&(e+=" "+a.responseText));if(d.context&&"piecemakerError"in d.context&&"function"==
typeof d.context.piecemakerError)d.context.piecemakerError(b,e,c.toUpperCase()+" "+g);else throw"undefined"!==typeof console&&console.log&&console.log(b,e,c),a;},headers:{"X-Access-Key":d.api_key}})},h=function(a,b){p(a,b.url,"get",b.data,b.success)},q=function(a,b){p(a,b.url,"put",b.data,b.success)},n=function(a,b){p(a,b.url,"post",b.data,b.success)},r=function(a,b){p(a,b.url,"delete",null,b.success)},d,g=function(a,b,c){this.context=this.api_key=this.host=void 0;var e=arguments[0];if(1===arguments.length&&
"object"==typeof e)this.context=e.context||{},this.api_key=e.api_key||!1,this.host=e.host||e.base_url||"http://localhost:3000";else if(a&&"object"==typeof a&&(this.context=a),b&&"string"==typeof b&&(this.host=b),c&&"string"==typeof c)this.api_key=c;this.host+="/api/v1";d=this};g.prototype.login=function(a,b,c){var e=c||f;if(!a||!b)throw"PieceMakerApi: need name and password to log user in";var d=this;n(this,{url:d.host+"/user/login",data:{email:a,password:b},success:function(a){var b=null;a&&("api_access_key"in
a&&a.api_access_key)&&(d.api_key=a.api_access_key,b=d.api_key);e.call(d.context||c,b)}})};g.prototype.logout=function(a){var b=a||f,c=this;n(this,{url:c.host+"/user/logout",success:function(e){e&&("api_access_key"in e&&e.api_access_key)&&(c.api_key=e.api_access_key);b.call(c.context||a,null)}})};g.prototype.listUsers=function(a){var b=a||f,c=this;h(this,{url:c.host+"/users",success:function(e){b.call(c.context||a,e)}})};g.prototype.whoAmI=function(a){var b=a||f,c=this;h(this,{url:c.host+"/user/me",
success:function(e){b.call(c.context||a,e)}})};g.prototype.createUser=function(a,b,c,e){var d=e||f,g=this;n(g,{url:g.host+"/user",data:{name:a,email:b,is_super_admin:c},success:function(a){d.call(g.context||e,a)}})};g.prototype.getUser=function(a,b){var c=b||f;h(this,{url:d.host+"/user/"+a,success:function(a){c.call(d.context||b,a)}})};g.prototype.updateUser=function(a,b,c,e,d,g){var l=g||f,h=this;q(h,{url:h.host+"/user/"+a,data:{name:b,email:c,password:e,api_access_key:d},success:function(a){l.call(h.context||
g,a)}})};g.prototype.deleteUser=function(a,b){var c=b||f;r(this,{url:d.host+"/user/"+a,success:function(){c.call(d.context||b)}})};g.prototype.listGroups=function(a){var b=a||f;h(this,{url:d.host+"/groups",success:function(c){b.call(d.context||a,c)}})};g.prototype.createGroup=function(a,b,c){var e=c||f,d=this;if(!a)throw"createGroup(): title can not be empty";n(d,{url:d.host+"/group",data:{title:a,text:b||""},success:function(a){e.call(d.context||c,a)}})};g.prototype.getGroup=function(a,b){var c=
b||f;h(this,{url:d.host+"/group/"+a,success:function(a){c.call(d.context||b,a)}})};g.prototype.updateGroup=function(a,b,c){var b=k(b),e=c||f,d=this;q(d,{url:d.host+"/group/"+a,data:b,success:function(a){e.call(d.context||c,a)}})};g.prototype.deleteGroup=function(a,b){var c=b||f;r(this,{url:d.host+"/group/"+a,success:function(){c.call(d.context||b)}})};g.prototype.listGroupUsers=function(a,b){var c=b||f;h(this,{url:d.host+"/group/"+a+"/users",success:function(a){c.call(d.context||b,a)}})};g.prototype.listEvents=
function(a,b){var c=b||f;h(this,{url:d.host+"/group/"+a+"/events",success:function(a){c.call(d.context||b,i(a))}})};g.prototype.listEventsOfType=function(a,b,c){var e=c||f;h(this,{url:d.host+"/group/"+a+"/events",data:{type:b},success:function(a){e.call(d.context||c,i(a))}})};g.prototype.listEventsWithFields=function(){var a=arguments[0],b={};if(3<arguments.length)for(var c=1;c<arguments.length-1;c+=2)b[arguments[c]]=arguments[c+1];else if("object"===typeof arguments[1])for(c in arguments[1])arguments[1].hasOwnProperty(c)&&
(b[c]=arguments[1][c]);else throw"Wrong parameter count";var e=arguments[arguments.length-1],g=e||f;h(d,{url:d.host+"/group/"+a+"/events",data:{fields:b},success:function(a){g.call(d.context||e,i(a))}})};g.prototype.listEventsBetween=function(a,b,c,e){var g=e||f;h(d,{url:d.host+"/group/"+a+"/events",data:{from:o(b),to:o(c)},success:function(a){g.call(d.context||e,i(a))}})};g.prototype.findEvents=function(a,b,c){var e=c||f;h(d,{url:d.host+"/group/"+a+"/events",data:b,success:function(a){e.call(d.context||
c,i(a))}})};g.prototype.getEvent=function(a,b,c){var e=c||f;h(d,{url:d.host+"/event/"+b,success:function(a){e.call(d.context||c,m(l(a)))}})};g.prototype.createEvent=function(a,b,c){var b=k(b),e=c||f;n(this,{url:d.host+"/group/"+a+"/event",data:b,success:function(a){e.call(d.context||c,m(l(a)))}})};g.prototype.updateEvent=function(a,b,c,e){c=k(c);c.event_group_id=a;var g=e||f;q(this,{url:d.host+"/event/"+b,data:c,success:function(a){g.call(d.context||e,m(l(a)))}})};g.prototype.deleteEvent=function(a,
b,c){var e=c||f;"object"===typeof b&&"id"in b&&(b=b.id);r(this,{url:d.host+"/event/"+b,success:function(a){e.call(d.context||c,m(l(a)))}})};g.prototype.getSystemTime=function(a){var b=a||f;h(this,{url:d.host+"/system/utc_timestamp",success:function(c){b.call(d.context||a,new Date(1E3*c.utc_timestamp))}})};g.prototype.createCallback=function(){if(1==arguments.length)return d.context[arguments[0]];if(2<=arguments.length){var a=1,b=d.context,c=arguments[0];if("string"!==typeof arguments[0]){b=arguments[0];
if("string"!==typeof arguments[1])throw"createCallback(): if first argument is a target then the second needs to be a method name";c=arguments[1];a=2}if(arguments.length>a){for(var e=[];a<arguments.length;a++)e.push(arguments[a]);var g=b,f=c;return function(a){a&&e.unshift(a);g[f].apply(g,e)}}return b[c]}throw"createCallback(): wrong number of arguments";};return g};if("undefined"!==typeof module&&module.exports){var t=function(){throw"Seems like you are running in neither a browser nor Node. Can't help you there.";
};if("undefined"!==typeof global)var v=require("url"),w=require("http"),t=function(j){var f=v.parse(j.url),k=JSON.stringify(j.data),i=j.headers||{};i["Content-Type"]="application/json";i["Content-Length"]=Buffer.byteLength(k,"utf8");f=w.request({host:f.hostname,port:f.port||80,path:f.path,method:j.type,headers:i},function(f){if(302===f.statusCode||300>=f.statusCode){var i="";f.on("data",function(f){i+=f});f.on("end",function(){j.success.apply(j.context,[JSON.parse(i)])})}else j.error.apply(null,[f])});
f.on("error",function(f){j.error&&j.error.apply(null,[f])});f.write(k);f.end()};module.exports=s(t)}else window&&!("PieceMakerApi"in window)&&(window.PieceMakerApi=s($.ajax))})();